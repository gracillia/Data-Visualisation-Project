<!DOCTYPE html>
<html>

<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.8"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
    integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
  <script src="index.js"></script>
  <title>Visualisation 2</title>
  <style>
    
    html {
      scroll-behavior: smooth;
    }

    body {
      text-align: center; /* Center-align the entire page content */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
  
    }

    .card-body {
      min-height: 250px;
    }

    #list {
      align-items: start;
      text-align: start;
    }

    .item {
      display: flex;
      text-align: start;
      margin: 50px;
    }
  </style>
</head>

<body>
  <!-- Title -->
  <div id="layout" class="pure-g">
    <div class="sidebar pure-u-1">
      <div class="header">
        <h1 class="title">World University Ranking 2023</h1>
        <p class="topic-meta">
          World University Rankings, commonly referred to as university league tables, are a series of annual lists that rank universities and higher education institutions worldwide.
          <br /> 
          These rankings are created based on five categories: Teaching Score, Research Score, Citation Score, Industry Income Score and International Outlook Score. 
          
          <br />
          Based on an article publiched by Times Higher Education in 2023:
          
          <br />
          <div id="list">

            <li>Teaching Scores represent the quality of the learning environment at universities.</li>
            <br />
            <li>Research quality evaluates the quality of research conducted at universities, which include the Research
              Score and Citation Score </li>
            <br />
            <li>Industry Income Score reflects the income generated by the university and its engagement with industry.
            </li>
            <br />
            <li>International Outlook Score considers the international dimension of universities, including students,
              staff, and research.</li>
          </ul>
          <br />
          The primary purpose of World University Rankings is to provide valuable information to prospective students,
          educators, researchers, policymakers, and the public.
          </p>
        </div>

      <!-- Map -->
      <div id="vis"></div>

      
      <select id="ddlFilter">
        <option value="No of student">
          No of student
        </option>
        <option value="No of student per staff">
          No of student per staff
        </option>

        <option value="Teaching Score">
          Teaching Score
        </option>
        <option value="Research Score">
          Research Score
        </option>
        <option value="Citations Score">
          Citations Score
        </option>

      </select>
      <!-- Map END -->

  

        <!-- Bar -->
        <br /> 
        <header class="topic-header">
          <h2 class="topic-title">Number of Students in Top 10 Universities</h2>
        
        </header>
         <div id="visBar"></div> 
         <p class="topic-meta">
          Among the top 10 universities, the University of California stands out for having the highest number of students.
          <br /> 
          University of Oxford, despite being the top-ranked university, it has only about half the number of students compared to the University of California. 
          <br /> 
          This observation underscores that a university's prestige or ranking doesn't necessarily correlate with the size of its student population.
        </p>
        
        <!-- Bubble -->
        <br /> 
        <header class="topic-header">
          <h2 class="topic-title">University Teaching and Research Scores with Overall Performance</h2>
        </header>
         <div id="bubblechart"></div> 
         <p class="topic-meta">
          From the bubble graph it can be seen that there is a positive relationship between a university's teaching score and research score. 
          <br />
          This means that universities with higher scores in both teaching and research tend to achieve higher ranks in the university rankings. 
          <br />
          Harvard University, which is ranked second, has the highest teaching score among the universities. 
          <br />
          While it may not hold the top position, its strong teaching score contributes to its high ranking. 
          <br />
          On the other side, the top-ranked University of Oxford is highlighted for having the highest research score. 
          <br />
          This demonstrates that research excellence can be a key factor in achieving the top position in university rankings.
          </p>

      

        <!-- Stackbar -->
        <br /> 
        <header class="topic-header">
          <h2 class="topic-title">Distribution of University Students by International Status</h2>
        </header>
         <div id="stackchart"></div> 
         <p class="topic-meta">
          From this chart, we can see that most of the students are local instead of international student. 
          <br /> 
          The predominance of local students over international students in university populations might be due to the cost of education, including tuition fees, living expenses, 
          <br /> 
          and potential scholarships which plays a pivotal role in a student's decision to study in their home country or venture abroad for higher education.
          <br /> 
          Many local students may choose to pursue their degrees within their own nation due to the financial advantages and familiarity of their home environment. 
         </p>

        <!-- Pie -->
        <br /> 
        <header class="topic-header">
          <h2 class="topic-title">Gender Distribution in World Top Universities</h2>
        </header>
         <div id="piechart"></div> 
         <br /> 
         <select id="universitySelect"></select>

         <p class="topic-meta">
          <p class="topic-meta">
            Observing from the top 10 universities, most of the universities maintain a balanced proportion of female and male students. 
            <br /> 
            This indicates that these universities are committed to fostering gender diversity and providing equal opportunities for both genders. 
            <br /> 
            Furthermore, in some universities, there are even more female students than male students, which is a positive sign that challenges  
            <br /> 
            the stereotype that males are inherently smarter or more capable than females. 
            <br /> 
            This demonstrates that academic excellence is not determined by gender.
           </p>


        


    <!-- Code -->
      <script>

        var pieItem = [];

        async function loadDDL() {
          await fetch('https://raw.githubusercontent.com/gracillia/Data-Visualisation-Project/main/uni_rank_clean.csv')
            .then(response => response.text())
            .then(data => {
              const csvData = vega.read(data, { type: 'csv' });

              pieItem = csvData.map(element => {
                const femaleToMaleRatio = parseRatio(element["Female:Male Ratio"]);
                return {
                  "University": element["Name of University"],
                  "FemaleRatio": femaleToMaleRatio.Female / (femaleToMaleRatio.Female + femaleToMaleRatio.Male),
                  "MaleRatio": femaleToMaleRatio.Male / (femaleToMaleRatio.Female + femaleToMaleRatio.Male)
                };
              });

              const universitySelect = document.getElementById("universitySelect");
              pieItem.forEach(entry => {
                const option = document.createElement("option");
                option.value = entry.University;
                option.textContent = entry.University;
                universitySelect.appendChild(option);
              });
            });


            getPie(pieItem[0].University)
        }

        async function getPie(selectedUniversity) {

          const selectedData = pieItem.find(entry => entry.University === selectedUniversity);
          const femaleToMaleRatio = selectedData.FemaleRatio / (selectedData.FemaleRatio + selectedData.MaleRatio);

          const spec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Female to Male Ratio",
            "data": {
              "values": [
                { "Category": "Female", "Value": femaleToMaleRatio },
                { "Category": "Male", "Value": 1- femaleToMaleRatio }
              ]
            },
            width: "580",
            height: "350",
            "mark": "arc",
            "encoding": {
              "theta": { "field": "Value", "type": "quantitative", "title": "Female:Male Ratio" },
              "color": { "field": "Category", "type": "nominal" },
             
              tooltip: [                                        // help change
            { "field": "Female:Male Ratio", "type": "nominal" },
            { "field": "University Rank", "type": "ordinal", "title": "University Rank" },
      
          ],

            }
          };

          vegaEmbed("#piechart", spec, { mode: "vega-lite" });
        };


        async function getData() {


          var value = document.getElementById("ddlFilter").value;

          await fetch('https://raw.githubusercontent.com/gracillia/Data-Visualisation-Project/main/uni_rank_clean.csv')
            .then(response => response.text())
            .then(data => {
              const csvData = vega.read(data, { type: 'csv' });
              const avgNoOfStudents = d3.max(csvData, d => d[value]);


              const spec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "World University Ranking",
                "background": "#F1FAFE",
                "width": 800,
                "height": 400,
                "projection": { "type": "equalEarth" },
                "data": {
                  "url": "https://raw.githubusercontent.com/dyan0033/Assignment-W9-Map/main/ne_110m_admin_0_countries.topojson",
                  "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
                },
                "transform": [
                  {
                    "lookup": "properties.NAME",
                    "from": {
                      "data": {
                        "url": "https://raw.githubusercontent.com/gracillia/Data-Visualisation-Project/main/uni_rank_clean.csv"
                      },
                      "key": "Location",
                      "fields": [value],
                      "default": 0
                    }
                  }
                ],
                "mark": { "type": "geoshape" },
                "encoding": {
                  "color": {
                    "field": value,
                    "type": "quantitative",
                    "scale": {
                      "type": "threshold",
                      "domain": [0, avgNoOfStudents / 4, avgNoOfStudents / 2, avgNoOfStudents / 4 * 3, avgNoOfStudents],
                      "range": ["#fee5d9", "#fcae91", "#fb6a4a", "#de2d26", "#a50f15", "#8B0000"]
                    }
                  },
                  "tooltip": [
                    { "field": "properties.NAME", "type": "nominal", "title": "Country" },
                    { "field": value, "type": "quantitative" }
                  ]
                },
                "config": {}
              };
              vegaEmbed("#vis", spec, { mode: "vega-lite" }).then(console.log).catch(console.warn);
            });
        }

        window.onload = getData();


        document.getElementById("ddlFilter").addEventListener("change", function () {
          getData();
        });


        async function getDataBubble() {
          const bubble =
          {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Bubble Chart of Universities",
            "data": {
              "url": "https://raw.githubusercontent.com/gracillia/Data-Visualisation-Project/main/uni_rank_clean.csv"
            },
            width: "600",
            height: "350",
            "mark": "circle",
            "encoding": {
              "x": {
                "field": "Teaching Score",
                "type": "quantitative",
                "axis": { "title": "Teaching Score" }
              },
              "y": {
                "field": "Research Score",
                "type": "quantitative",
                "axis": { "title": "Research Score" }
              },
              "size": {
                "field": "OverAll Score",
                "type": "quantitative",
                "scale": { "domain": [0, 100]  },
                "title": "OverAll Score"

              },
              "color": {
                "field": "OverAll Score",
                "type": "quantitative",
                "scale": { "domain": [0, 100],"range": ["#9ECAE1", "#2171B5", "#08519C", "#08306B",]  }, // You can customize the color scale here
                "title": "OverAll Score"
              },

              "tooltip": [
                { "field": "University Rank", "type": "ordinal", "title": "University Rank" },
                { "field": "Name of University", "type": "nominal", "title": "University" },
                { "field": "Teaching Score", "type": "quantitative", "title": "Teaching Score" },
                { "field": "Research Score", "type": "quantitative", "title": "Research Score" },
                { "field": "OverAll Score", "type": "quantitative", "title": "Overall Score" }
              ]
            }
          }



          vegaEmbed("#bubblechart", bubble, { mode: "vega-lite" }).then(console.log).catch(console.warn);

        }


        async function getStackedBar() {

          const percentToDecimal = (percentStr) => {
            return parseFloat(percentStr) / 100;
          };



          await fetch('https://raw.githubusercontent.com/gracillia/Data-Visualisation-Project/main/uni_rank_clean.csv')
            .then(response => response.text())
            .then(data => {
              const csvData = vega.read(data, { type: 'csv' });

              var listStudent = [

              ];

              var count = 0;

              csvData.every(element => {
                listStudent.push({
                  "University": element["Name of University"],
                  "No of student": element["No of student"],
                  "International Student": percentToDecimal(element["International Student"]) * element["No of student"],
                });
                count++;
                if (count >= 10) {
                  return false;
                }
                return true;
              }

              );
              var stacked = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "description": "Stacked Bar Chart: International Student Percentage",
                "data": {
                  "values": listStudent
                },
                width: "580",
                height: "350",
                "transform": [
                  {
                    "fold": [
                      "No of student",
                      "International Student",
                    ],
                    "as": [
                      "key",
                      "value"
                    ]
                  }
                ],
                "mark": "bar",
                "encoding": {
                  "x": { "field": "University", "type": "ordinal", "title": "University" },
                  "y": { "field": "value", "type": "quantitative", "title": "Number of Students" },
                  "color": {
                    "type": "nominal",
                    "field": "key",
                    "title": "Student Type"
                  },
                  "tooltip": [
                    { "field": "University", "type": "nominal", "title": "University" },
                    { "field": "No of student", "type": "quantitative", "title": "Total Students" },
                    { "field": "International Student", "type": "quantitative", "title": "International Students" }
                  ]
                }
              }
              vegaEmbed("#stackchart", stacked, { mode: "vega-lite" }).then(console.log).catch(console.warn);


            }
            );
        }

        async function getDataBar() {


          var value = document.getElementById("ddlFilter").value;

          await fetch('https://raw.githubusercontent.com/gracillia/Data-Visualisation-Project/main/uni_rank_clean.csv')
            .then(response => response.text())
            .then(data => {
              const csvData = vega.read(data, { type: 'csv' });

              var listStudent = [

              ];

              var count = 0;

              csvData.every(element => {
                listStudent.push({
                  "University": element["Name of University"],
                  "No of student": element["No of student"],
                  "Ranking": element["University Ranking"],
                });

                listStudent.sort((a, b) => a.Ranking - b.Ranking);

                count++;
                if (count >= 10) {
                  return false;
                }
                return true;
              }
              );


              const spec = {
                "data": {
                  "values": listStudent
                },
                width: "580",
                height: "350",
                "mark": { "type": "bar", "cornerRadiusEnd": 4 },
                "encoding": {
                  "x": { "field": "University", "type": "ordinal" },
                  "y": { "field": "No of student", "type": "quantitative" },
                  "tooltip": [
                    { "field": "University", "type": "nominal", "title": "University" },
                    { "field": "No of student", "type": "quantitative", "title": "Total Students" },
                    
                  ]
                }
              }
              vegaEmbed("#visBar", spec, { mode: "vega-lite" }).then(console.log).catch(console.warn);
            });



        }

        const parseRatio = (ratioStr) => {
          const [femaleCount, maleCount] = ratioStr.split(':').map(Number);
          return { Female: femaleCount, Male: maleCount };
        };

        window.onload = getDataBar();
        window.onload = getDataBubble();
        window.onload = getStackedBar();
        window.onload = loadDDL();
        universitySelect.addEventListener("change", (event) => {
          getPie(event.target.value);
        });

        // Set the initial chart based on the first university

      </script>
      

</body>

</html>